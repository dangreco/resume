---
# yaml-language-server: $schema=https://www.schemastore.org/github-workflow.json
# yamllint disable rule:line-length
# yamllint disable rule:comments
name: PR
on:
  pull_request:
jobs:
  build-preview:
    runs-on: ubuntu-latest
    permissions:
      contents: read
      pull-requests: write
    steps:
      - name: Checkout repository
        uses: actions/checkout@08eba0b27e820071cde6df949e0beb9ba4906955 # v4.3.0

      - name: Install Nix
        uses: DeterminateSystems/determinate-nix-action@9596b92e70cbf68a494a2b0273cb5b680184f5fc # v3.13.1

      - name: Initialize Nix shell
        run: nix develop .#ci --command true

      - name: Build PDF
        run: nix develop .#ci --command task typst:build

      - name: Upload PDF
        uses: actions/upload-artifact@ea165f8d65b6e75b540449e92b4886f43607fa02 # v4.6.2
        with:
          name: resume-pr-${{ github.event.pull_request.number }}
          path: _build/resume.en.pdf
          retention-days: 30

      - name: Comment PR with preview
        uses: marocchino/sticky-pull-request-comment@773744901bac0e8cbb5a0dc842800d45e9b2b405 # v2.9.4
        with:
          header: resume-preview
          message: |
            ## Resume Preview

            A preview PDF has been generated for this PR.

            **Download:** [resume.en.pdf](https://github.com/${{ github.repository }}/actions/runs/${{ github.run_id }}#artifacts)

            <details>
            <summary>Artifact Details</summary>

            - **Artifact ID:** `${{ steps.upload.outputs.artifact-id }}`
            - **Artifact URL:** `${{ steps.upload.outputs.artifact-url }}`
            - **Run ID:** `${{ github.run_id }}`
            - **Retention:** 30 days

            </details>
